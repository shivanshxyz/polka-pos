import { scan, mergeMap, share } from 'rxjs';

const getNewBlocks$ = (pinnedBlocks$) => pinnedBlocks$.pipe(
  scan(
    ({ reportedBlocks: prevReportedBlocks }, { blocks }) => {
      const reportedBlocks = new Set(blocks.keys());
      const newBlocks = [];
      if (reportedBlocks.size > prevReportedBlocks.size) {
        blocks.forEach(({ hash, number, parent }) => {
          if (!prevReportedBlocks.has(hash)) {
            newBlocks.push({
              hash,
              number,
              parent
            });
          }
        });
      }
      return { reportedBlocks, newBlocks };
    },
    {
      reportedBlocks: /* @__PURE__ */ new Set(),
      newBlocks: new Array(0)
    }
  ),
  mergeMap(({ newBlocks }) => newBlocks),
  share()
);

export { getNewBlocks$ };
//# sourceMappingURL=new-blocks.mjs.map
